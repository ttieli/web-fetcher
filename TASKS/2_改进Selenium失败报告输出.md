# 2_改进Selenium失败报告输出

## 背景
- 目前 Selenium 失败时仍会生成与成功抓取相似的 Markdown 文件，标题为“未命名”，错误只出现在 HTML 注释和尾注中。
- `FetchMetrics` 已能标记 `final_status="failed"`，但 `webfetcher.py` 未利用该信息生成专门的失败报告。

## 目标
- Selenium 失败时生成醒目的失败 Markdown，标题与正文直接告知原因和快速修复方法。
- 输出文件名区分失败/成功（如前缀 `FAILED_`），避免用户误以为抓取成功。
- 命令行模式在失败时仍返回非零退出码（与任务 1 协调）。

## 验收标准
1. 触发 Selenium 失败后，输出文件标题包含 "⚠" 或 "FAILED" 等明确标识，正文首段列出 URL、错误原因和修复步骤。
2. 失败文件名形如 `FAILED_2025-10-01-120000 - example.com.md`。
3. `FetchMetrics` 中的错误信息被完整写入失败 Markdown，而不是隐藏在注释里。
4. 单元/集成测试覆盖至少一种失败场景，并验证生成文件内容。

## 实施步骤
1. **失败检测**：在 `webfetcher.py` 生成 Markdown 前检查 `metrics.final_status` 和 `html_content` 是否为空/失败。
2. **模板生成**：新增失败报告生成函数（可放在现有 Markdown 输出模块中），包含错误摘要、故障排除步骤及原始信息。
3. **文件命名**：更新输出路径生成逻辑，对失败场景前置 `FAILED_` 或类似标记。
4. **测试与文档**：补充测试脚本并在 README 或使用文档中说明失败文件的命名及定位方式。

## 备注
- 可复用原 `FAILURE_MD_COMPARISON` 的对比示例作为参考模板。
- 注意与任务 1 的终端退出码需求保持一致，避免重复处理。
