# 2_优化失败报告生成格式
# Optimize Failure Report Generation Format

## 背景 / Background
- 目前 Selenium 失败时仍会生成与成功抓取相似的 Markdown 文件，标题为“未命名”，错误只出现在 HTML 注释和尾注中。
- `FetchMetrics` 已能标记 `final_status="failed"`，但 `webfetcher.py` 未利用该信息生成专门的失败报告。

## 目标 / Goals
- Selenium 失败时生成醒目的失败 Markdown，标题与正文直接告知原因和快速修复方法。
  Generate prominent failure Markdown with clear error reasons and quick fix methods in title and content.
- 输出文件名区分失败/成功（如前缀 `FAILED_`），避免用户误以为抓取成功。
  Distinguish failed/successful outputs with filename prefixes to avoid confusion.
- 命令行模式在失败时仍返回非零退出码（与任务 1 协调）。
  Return non-zero exit codes for failures in CLI mode (coordinated with Task 1).

## 验收标准 / Acceptance Criteria
1. 触发 Selenium 失败后，输出文件标题包含 "⚠" 或 "FAILED" 等明确标识，正文首段列出 URL、错误原因和修复步骤。
2. 失败文件名形如 `FAILED_2025-10-01-120000 - example.com.md`。
3. `FetchMetrics` 中的错误信息被完整写入失败 Markdown，而不是隐藏在注释里。
4. 单元/集成测试覆盖至少一种失败场景，并验证生成文件内容。

## 实施步骤 / Implementation Steps
1. **失败检测 / Failure Detection**：
   在 `webfetcher.py` 生成 Markdown 前检查 `metrics.final_status` 和 `html_content` 是否为空/失败。
   Check `metrics.final_status` and `html_content` for failure before generating Markdown.

2. **模板生成 / Template Generation**：
   新增失败报告生成函数，包含错误摘要、故障排除步骤及原始信息。
   Add failure report generation function with error summary, troubleshooting steps, and raw info.

3. **文件命名 / File Naming**：
   更新输出路径生成逻辑，对失败场景前置 `FAILED_` 或类似标记。
   Update output path logic to prepend `FAILED_` for failure scenarios.

4. **测试与文档 / Testing & Documentation**：
   补充测试脚本并在文档中说明失败文件的命名及定位方式。
   Add test scripts and document failure file naming conventions.

## 备注 / Notes
- 可复用原 `FAILURE_MD_COMPARISON` 的对比示例作为参考模板。
  Can reuse the `FAILURE_MD_COMPARISON` example as reference template.
- 注意与任务 1 的终端退出码需求保持一致，避免重复处理。
  Coordinate with Task 1's exit code requirements to avoid duplication.
- 前置条件：完成Task 1 Phase 3后开始此任务。
  Prerequisite: Start after completing Task 1 Phase 3.
